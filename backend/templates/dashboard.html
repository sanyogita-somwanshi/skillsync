<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SkillSync - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .color-primary { background-color: #0d9488; } 
        .color-accent { background-color: #38bdf8; } 
        .rounded-xl-lg { border-radius: 1.5rem; }
        .transition-ease { transition: all 0.3s ease-in-out; }
        
        /* --- CHATBOT CSS (Standardized) --- */
        .chatbot-button { position: fixed; bottom: 30px; right: 30px; z-index: 1000; cursor: pointer; }
        .chatbot-icon { box-shadow: 0 10px 15px -3px rgba(13, 148, 136, 0.5); }
        .chatbot-window { position: fixed; bottom: 30px; right: 30px; width: min(90vw, 380px); height: min(70vh, 550px); z-index: 1001; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2); display: none; flex-direction: column; }
        .user-message { background-color: #38bdf8; color: white; border-radius: 1rem 1rem 0.2rem 1rem; padding: 10px 14px; margin-bottom: 10px; align-self: flex-end; max-width: 80%; }
        .ai-message { background-color: #f0fdfa; border: 1px solid #0d9488; border-radius: 1rem 1rem 1rem 0.2rem; padding: 10px 14px; margin-bottom: 10px; align-self: flex-start; max-width: 80%; }
        .animate-pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    </style>
</head>
<body class="font-sans text-gray-800 bg-gray-50 min-h-screen flex flex-col">
    <header class="sticky top-0 z-50 bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center h-20">
            <a href="{{ url_for('home') }}" class="text-3xl font-bold text-teal-600 tracking-wider">SkillSync</a>
            <div>
                <a href="{{ url_for('home') }}" class="text-gray-600 hover:text-teal-600 font-medium transition-ease mr-6">Home</a>
                <a href="{{ url_for('logout') }}" class="bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 transition-ease">Logout</a>
            </div>
        </div>
    </header>

    <main class="flex-grow py-16 md:py-24">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <h1 class="text-4xl font-extrabold text-gray-900 mb-2 text-center">Welcome to Your SkillSync Dashboard</h1>
            <p class="text-xl text-gray-600 mb-6 text-center max-w-3xl mx-auto">Welcome, **{{ username }}**! Here is your current employability profile.</p>
            
            <div class="bg-white p-6 md:p-8 rounded-xl-lg shadow-2xl mb-12 border-t-4 border-sky-500">
                <h2 class="text-2xl font-bold mb-4 text-gray-900">üöÄ Overall Status</h2>
                <p class="text-lg text-gray-700 font-semibold mb-2">{{ gaps['status_message'] }}</p>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8">
                <div class="p-8 bg-white rounded-xl-lg shadow-2xl border border-teal-100 flex flex-col justify-between hover:shadow-teal-300/50 transition-ease">
                    <div>
                        <div class="text-4xl text-teal-600 mb-4">‚öôÔ∏è Technical Skills</div>
                        <h2 class="text-2xl font-bold mb-3 text-gray-900">Level {{ gaps['Technical']['level'] }}/5</h2>
                        
                        <div class="h-5 bg-gray-200 rounded-full overflow-hidden mb-3">
                            <div class="bg-teal-500 h-full" style="width: {{ (gaps['Technical']['level']|int * 20) }}%;"></div>
                        </div>

                        <p class="text-sm text-gray-600 mb-6">Gap: {{ gaps['Technical']['total_gap'] }} levels to close.</p>
                    </div>
                    <a href="{{ url_for('technical_roadmap') }}" class="color-primary text-white font-bold text-lg py-3 w-full rounded-xl-lg shadow-xl hover:opacity-90 text-center">Update Roadmap</a>
                </div>

                <div class="p-8 bg-white rounded-xl-lg shadow-2xl border border-sky-100 flex flex-col justify-between hover:shadow-sky-300/50 transition-ease">
                    <div>
                        <div class="text-4xl text-teal-600 mb-4">üí¨ Soft Skills</div>
                        <h2 class="text-2xl font-bold mb-3 text-gray-900">Level {{ gaps['Soft']['level'] }}/5</h2>
                        
                        <div class="h-5 bg-gray-200 rounded-full overflow-hidden mb-3">
                            <div class="bg-sky-500 h-full" style="width: {{ (gaps['Soft']['level']|int * 20) }}%;"></div>
                        </div>
                        
                        <p class="text-sm text-gray-600 mb-6">Gap: {{ gaps['Soft']['total_gap'] }} levels to close.</p>
                    </div>
                    <a href="{{ url_for('non_tech') }}" class="color-accent text-white font-bold text-lg py-3 w-full rounded-xl-lg shadow-xl hover:opacity-90 text-center">Soft Skill Activities</a>
                </div>
            </div>
        </div>
    </main>
    
    <div id="chatbot-button" class="chatbot-button transition-ease hidden" onclick="toggleChatbot()">
        <div class="color-primary chatbot-icon rounded-full p-4 text-white hover:shadow-xl hover:scale-105 transition-ease flex items-center justify-center">
            <span class="text-3xl font-bold">üí¨</span>
        </div>
    </div>
    
    <div id="chatbot-window" class="chatbot-window bg-white rounded-xl-lg border-2 border-teal-500">
        <div class="p-4 color-primary text-white font-bold flex justify-between items-center rounded-t-xl-lg">
            <span>AI Career Guide</span>
            <button onclick="toggleChatbot()" class="text-xl font-light hover:text-gray-200">‚úï</button>
        </div>
        <div id="chat-messages" class="flex-grow p-4 overflow-y-auto flex flex-col bg-gray-50">
             <div class="ai-message">
                üëã Hi {{ username }}! I can help you analyze your dashboard or suggest next steps.
            </div>
        </div>
        <div class="p-3 border-t border-gray-200 flex bg-white rounded-b-xl-lg">
            <input type="text" id="chat-input" placeholder="Ask me anything..." class="flex-grow p-2 border border-gray-300 rounded-l-lg focus:outline-none focus:border-teal-500 text-sm">
            <button onclick="sendMessage()" id="send-button" class="bg-teal-600 text-white px-4 py-2 rounded-r-lg font-semibold hover:bg-teal-700 transition-ease text-sm">Send</button>
        </div>
    </div>

    <script>
        function toggleChatbot() {
            const w = document.getElementById('chatbot-window');
            w.style.display = (w.style.display === 'none' || w.style.display === '') ? 'flex' : 'none';
        }

        function appendMessage(sender, message) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex w-full ${sender === 'user' ? 'justify-end' : 'justify-start'} mb-2`;
            messageDiv.innerHTML = `<div class="${sender === 'user' ? 'user-message' : 'ai-message'}">${message}</div>`;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showLoading() {
            const chatMessages = document.getElementById('chat-messages');
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loading-indicator';
            loadingDiv.className = 'flex justify-start mb-2';
            loadingDiv.innerHTML = `<div class="ai-message animate-pulse">Thinking...</div>`;
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            document.getElementById('send-button').disabled = true;
        }

        function hideLoading() {
            const loading = document.getElementById('loading-indicator');
            if (loading) loading.remove();
            document.getElementById('send-button').disabled = false;
        }

        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const prompt = input.value.trim();
            if (!prompt) return;
            
            input.value = '';
            appendMessage('user', prompt);
            showLoading();

            try {
                // FIX: Connects to the Python Backend
                const response = await fetch('/api/chat', { 
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify({ message: prompt }) 
                });
                
                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text || "I'm struggling to connect. Please try again.";
                
                hideLoading();
                appendMessage('ai', text);
            } catch (e) {
                hideLoading();
                appendMessage('ai', "Server error. Please check your internet connection.");
            }
        }
        
        document.getElementById('chat-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') sendMessage();
        });

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('chatbot-button').classList.remove('hidden'); 
        });
    </script>
</body>
</html> 
